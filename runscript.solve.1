#!/bin/bash

# Job name:
#SBATCH --job-name=std.nbl
#
# Project:
#SBATCH --account=nn9696k
#
# Wall time limit:
#SBATCH --time=02:00:00
#
# Job type:
#SBATCH --qos=short
#
# Cores request:
#SBATCH --nodes=4 --ntasks-per-node=32

## Set up job environment:
set -o errexit  # Exit the script on any error
set -o nounset  # Treat any unset variables as an error


source $HOME/.bash_profile
OpenFOAM-2.4.x-central
module list

cd $PBS_O_WORKDIR

cores=128

initializer=setFieldsABL
solver=ABLSolver
runNumber=1
startTime=0

cp system/controlDict.$runNumber system/controlDict

echo "Starting OpenFOAM job at: " $(date)
echo "using " $cores " cores"

# Run the flow field initializer (parallel)
if [ $runNumber -eq 1 ] 
   then
   mpirun -np $cores $initializer -parallel > log.$runNumber.$initializer 2>&1
fi

# Run the solver (parallel)
mpirun -np $cores $solver -parallel > log.$runNumber.$solver 2>&1

echo "Ending OpenFOAM job at: " $(date)
